<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org/">
<head>
    <th:block th:replace="~{layout/main :: layout-head}"></th:block>
    <title>New Recipe</title>
</head>
<body class="d-flex flex-column min-vh-100">
<main class="flex-grow-1">
    <div th:replace="~{layout/main :: navbar}"></div>

    <header class="py-3">
        <div class="container px-5">
            <div class="row gx-5 align-items-center">
                <div>
                    <div class="text-center text-xxl-center">
                        <h1 class="display-2 fw-bolder mb-5"><span class="text-gradient d-inline">New Recipe</span></h1>
                    </div>
                </div>

            </div>
        </div>
    </header>

    <div class="bg-light rounded-4 py-5 px-4 px-md-5">
        <form id="recipeForm" name="recipeForm" th:action="@{/recipes/new}" th:object="${recipe}" method="post">
            <div class="text-start mb-2">
                <p class="fw-lighter text-muted mb-0">(<span class="required-field">*</span>)Please fill in the required fields.</p>
            </div>
            <div class="row gx-5 justify-content-center">
                <div class="col-lg-6 col-lg-4">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="name" th:field="*{name}"
                               placeholder="Recipe Name" required>
                        <label for="name"><span class="required-field">*</span>Recipe Name</label>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="description" th:field="*{description}"
                               placeholder="Description" required>
                        <label for="description"><span class="required-field">*</span>Description</label>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('description')}" th:errors="*{description}"></div>
                    </div>
                    <div class="mb-3">
                        <label for="modalCategorySearch"><span class="required-field">*</span>Categories</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="modalCategorySearch" placeholder="Enter category name" />
                            <button class="btn btn-outline-secondary" type="button" onclick="categoryPlugin.search()">
                                <i class="bi-search"></i>
                            </button>
                        </div>
                        <div id="categorySearchResults" class="list-group mt-2 search-result-div"></div>
                        <div id="selectedCategories" class="mt-2"></div>
                        <input type="hidden" id="modalCategories" name="categoryCodes" />
                    </div>
                    <div class="mb-3">
                        <label for="modalIngredientSearch"><span class="required-field">*</span>Ingredients</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="modalIngredientSearch" placeholder="Enter ingredient name" />
                            <button class="btn btn-outline-secondary" type="button" onclick="ingredientPlugin.search()">
                                <i class="bi-search"></i>
                            </button>
                        </div>
                        <div id="ingredientSearchResults" class="list-group mt-2 search-result-div"></div>
                        <div id="selectedIngredients" class="mt-2"></div>
                        <input type="hidden" id="modalIngredients" name="ingredientCodes" />
                    </div>
                    <div class="form-floating mb-3">
                        <textarea class="form-control" id="recipe" th:field="*{recipe}"
                                  placeholder="Recipe" style="height: 100px"></textarea>
                        <label for="recipe"><span class="required-field">*</span>Recipe</label>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('recipe')}" th:errors="*{recipe}"></div>
                    </div>
                    <div class="form-floating mb-3">
                        <select class="form-select" id="servingUnit" th:field="*{servingUnit}" required>
                            <option value="">Select Serving Unit</option>
                            <option th:each="unit : ${servingUnits}" th:value="${unit.code}"
                                    th:text="${unit.name + ' (' + unit.code + ')'}">Serving Unit (Code)</option>
                        </select>
                        <label for="servingUnit"><span class="required-field">*</span>Serving Unit</label>
                        <div th:if="${#fields.hasErrors('servingUnit')}" class="text-danger" th:errors="*{servingUnit}"></div>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="servingAmount" th:field="*{servingAmount}" placeholder="Nutrition Value">
                        <label for="servingAmount"><span class="required-field">*</span>Serving Amount</label>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('servingAmount')}" th:errors="*{servingAmount}"></div>
                    </div>
                    <div class="form-floating mb-3">
                        <textarea class="form-control" id="tips" th:field="*{tips}"
                                  placeholder="Tips" style="height: 100px"></textarea>
                        <label for="tips">Tips</label>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('tips')}" th:errors="*{tips}"></div>
                    </div>
                </div>
                <div class="col-lg-6 col-lg-4">
                    <div th:each="type, index : ${nutritionalTypes}" th th:if="${!nutritionalTypes.isEmpty()}">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" th:id="'type_' + ${type.getId()}" placeholder="Nutrition Value">
                            <label th:for="'type_' + ${type.getId()}" th:text="${type.getName()}">Nutrition Value</label>
                        </div>
                    </div>
                    <div class="form-floating mb-3">
                        <label class="form-label"><span class="required-field">*</span>Sample Recipe Image</label>
                        <div class="image-upload-area" id="recipeImageArea">
                            <div id="recipeImagePreview">
                                <i class="bi bi-cloud-upload display-4 text-muted"></i>
                                <p class="mt-2 text-muted">To upload image drag or select from file system...</p>
                                <small class="text-muted">PNG, JPG, GIF (Max: 2MB)</small>
                            </div>
                            <img id="recipePreviewImg" class="preview-image mt-3" style="display: none;">
                            <button type="button" id="removeImageBtn" class="btn btn-danger btn-sm position-absolute top-0 end-0 m-2" style="display:none;">
                                <i class="bi bi-x-lg"></i>
                            </button>
                        </div>
                        <input type="file" id="recipeFile" name="recipeFile" accept="image/*" style="display: none;">
                    </div>
                </div>
            </div>
            <div class="row gx-5 justify-content-end">
                <div class="col-lg-2 col-lg-2">
                    <div class="form-floating mb-3">
                        <div th:replace="~{layout/buttons :: submit-button('Save')}"></div>
                    </div>
                </div>
            </div>
        </form>
    </div>

</main>

<div th:replace="~{layout/main :: footer}"></div>

<script th:replace="~{layout/main :: scripts}"></script>
<script th:replace="~{layout/main :: form-scripts}"></script>
<script th:src="@{/js/custom/recipe.js}"></script>

</body>
</html>