<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org/">
<head>
    <th:block th:replace="~{layout/main :: layout-head}"></th:block>
    <title>New Recipe</title>
</head>
<body class="d-flex flex-column min-vh-100">
<main class="flex-grow-1">
    <div th:replace="~{layout/main :: navbar}"></div>

    <header class="py-5">
        <div class="container px-5">
            <div class="row gx-5 align-items-center">
                <div>
                    <div class="text-center text-xxl-center">
                        <h1 class="display-3 fw-bolder mb-5"><span class="text-gradient d-inline">New Recipe</span></h1>
                    </div>
                </div>

            </div>
        </div>
    </header>

    <div class="bg-light rounded-4 py-5 px-4 px-md-5">
        <div class="text-center mb-5">
            <p class="lead fw-normal text-muted mb-0">(<span class="required-field">*</span>)Please fill in the required fields.</p>
        </div>
        <div class="row gx-5 justify-content-center">
            <div class="col-lg-8 col-xl-4">
                <div th:replace="~{layout/messages :: submit-messages}"></div>
                <form id="recipeForm" name="recipeForm" th:action="@{/recipes/new}" th:object="${recipe}" method="post">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="name" th:field="*{name}"
                               placeholder="Recipe Name" required>
                        <label for="name"><span class="required-field">*</span>Recipe Name</label>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="description" th:field="*{description}"
                               placeholder="Description" required>
                        <label for="description"><span class="required-field">*</span>Description</label>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('description')}" th:errors="*{description}"></div>
                    </div>
                    <div class="form-floating mb-3">
                        <select th:field="*{categories}" class="form-select" id="categories" required>
                            <option value="">Select Category</option>
                            <option th:each="category : ${categories}" th:value="${category.code}" th:text="${category.name}"></option>
                        </select>
                        <label for="categories"><span class="required-field">*</span>Categories</label>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('categories')}" th:errors="*{categories}"></div>
                    </div>

                    <div class="form-floating mb-3">
                        <div class="input-group">
                            <input type="text" class="form-control" id="modalIngredientSearch" placeholder="Enter ingredient name" />
                            <button class="btn btn-outline-secondary" type="button" onclick="ingredientPlugin.search()">
                                <i class="bi-search"></i>
                            </button>
                        </div>
                        <div id="ingredientSearchResults" class="list-group mt-2" style="display:none; max-height:200px; overflow-y:auto;"></div>
                        <div id="selectedIngredients" class="mt-2"></div>
                        <input type="hidden" id="modalIngredients" name="ingredientIds" />
                    </div>

                    <div class="form-floating mb-3">
                        <textarea class="form-control" id="recipe" th:field="*{recipe}"
                                  placeholder="Recipe" style="height: 100px"></textarea>
                        <label for="recipe">Recipe<span class="required-field">*</span></label>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('recipe')}" th:errors="*{recipe}"></div>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="servingUnit" th:field="*{servingUnit}" placeholder="Nutrition Unit">
                        <label for="servingUnit">Serving Unit</label>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('servingUnit')}" th:errors="*{servingUnit}"></div>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="servingAmount" th:field="*{servingAmount}" placeholder="Nutrition Value">
                        <label for="servingAmount">Serving Amount</label>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('servingAmount')}" th:errors="*{servingAmount}"></div>
                    </div>
                    <div class="form-floating mb-3">
                        <!--                        TODO: MultiSelect-->
                        <select class="form-select" id="nutritionalValues" th:field="*{nutritionalValues}">
                            <option value="">Select Nutritional Value</option>
                        </select>
                        <label for="ingredients"><span class="required-field">*</span>Nutritional Values</label>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('ingredients')}" th:errors="*{ingredients}"></div>
                    </div>
                    <div class="form-floating mb-3">
                        <textarea class="form-control" id="tips" th:field="*{tips}"
                                  placeholder="Tips" style="height: 100px"></textarea>
                        <label for="tips">Tips</label>
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('tips')}" th:errors="*{tips}"></div>
                    </div>

                    <div th:replace="~{layout/buttons :: submit-button('Save')}"></div>
                </form>
            </div>
        </div>
    </div>

</main>

<div th:replace="~{layout/main :: footer}"></div>

<script th:replace="~{layout/main :: scripts}"></script>
<script th:replace="~{layout/main :: form-scripts}"></script>
<script th:src="@{/js/custom/ingredient-selector.js}"></script>
<script th:src="@{/js/custom/recipe.js}"></script>

</body>
</html>